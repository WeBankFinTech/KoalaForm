---
sidebarDepth: 3
---

# 设计原理
我们结合接口来分析下完整表单页面的组成元素：查询表单、列表及分页、新增表单、更新表单、详情表单、删除表单。

## 接口到表单
### 一般查询接口的设计是这样的
- 请求体

| 属性         | 类型                    | 说明 |
| ------------ | ----------------------- | ------ |
| name | string | 姓名   |
| age | number | 年龄 |

- 响应体

| 属性         | 类型                    | 说明 |
| ------------ | ----------------------- | ------ |
| code | string |
| msg | string |
| result| Object | 结果
| - list| `Array<Object>` |
|   -- name | string | 姓名
|   -- age | number | 年龄 |
| - pager | Object |

请求体对应查询表单、列表对应响应体的list、分页对应响应体的pager
![查询](/page.png)

### 而新增、更新、删除的接口请求体是这样
- 请求体

| 属性         | 类型                    | 说明 |
| ------------ | ----------------------- | ------ |
| id | string | ID  |
| name | string | 姓名   |
| age | number | 年龄 |

![新增](/insert-form.png)
![更新](/update-form.png)
![详情](/view-form.png)

### 详情一般就是查询列表的一条记录

![删除](/delete-form.png)

## 字段定义
通过图片观察到 **`红色圈圈`** 的内容都是接口的字段，我们看下这些字段重复情况：

| 位置         |   ID                     |  姓名            | 年龄
| ------------ | ----------------------- | --------------- | -----------------
| 查询表单  |  | Y  | Y
| 列表  | Y | Y  | Y
| 新增表单  |  | Y  | Y
| 更新表单  | Y | Y  | Y
| 删除表单  | Y |
| 详情表单  | Y | Y  | Y

每个地方使用的字段都有重复，只是某些字段在一些情况下不需要使用，例如：更新时id是必须要传递的，也不能变更的，在form中需要隐藏或者disabled；删除时只需要传递id给接口；新增时id会被忽略。
仅仅这点差异并不值得每个地方都定义一次，我们提供了[Field](./base//field.md)来定义字段的规则，通过[Field](./base//field.md)规则的解析，就可以获取对应的model和render。


## 动作定义
图片中 **`红色圈圈`** 的内容是用户的交互动作，用户触发对应的逻辑如下：
| 动作         |   执行逻辑               |
| ------------ | ----------------------- |
| 查询按钮  | 查询表单的model格式化为查询接口的参数，调用接口后返回的list作为table的展示数据，pager作为分页数据 |
| 查询表单重置按钮  | 重置查询表单，并自动触发查询 |
| 新增按钮  | 重置新增表单，打开新增表单的modal或者跳转到新增表单页面 |
| 列表操作 > 更新按钮  | 查询记录的详情或直接使用记录作为详情，格式化后赋值给更新表单model，打开modal或跳转到更新页面 |
| 列表操作 > 详情按钮  | 查询记录的详情或直接使用记录作为详情，格式化后赋值给详情表单model，打开modal或跳转到详情页面 |
| 列表操作 > 删除按钮  | 查询记录的详情或直接使用记录作为详情，格式化后赋值给删除表单model，打开modal或跳转到删除页面，一般删除只需要记录ID |
| 新增表单 > 确定按钮  | 校验表单字段规则，校验通过后格式化model为新增接口的参数，并调用接口，成功后返回列表页并刷新列表 |
| 更新表单 > 确定按钮  | 校验表单字段规则，校验通过后格式化model为更新接口的参数，并调用接口，成功后返回列表页并刷新列表 |
| 删除表单 > 确定按钮  | 一般取记录ID作为删除接口的参数，并调用接口，成功后返回列表页并刷新列表 | 
| 详情表单 > 确定按钮  | 返回列表页 |

分析上表，我们可以抽象出一些通用的逻辑：
- 接口调用
- 重置表单
- 打开、关闭modal
- 表单字段校验
- 表单赋值

还有非通用的逻辑，比如接口参数的格式化，可以通过`Config`来配置。


## 组合
有了字段定义和Config，根据这两定义可以解析出不同的粒度的应用场景。

`useForm`是我们最基础的场景，可以解析出表单的model、rules、render、重置、初始化、赋值等。

`useTable`是用于列表的场景，可以解析出表单的列定义、分页、render等。

`useFormAction`是基于useForm加上了动作的逻辑，你可以根据动作的类型，获取对应的表单handle、render等。

`useQuery`是基于useFormAction和useTable组合出查询表单+列表展示数据的场景。

`useModal`是基于useFormAction组合出用modal展示新增、更新、详情表单的场景。

`usePage`是基于useQuery和useModal组合出完整的CURD表单页面。

## 定制化
上面的应用场景都会提供render方法渲染对应的场景，为了能够定制化render，我们提供了preset的能力。

当然我们也会实现一些Preset，这些Preset已经基本能满足大部分场景。

`@koala-form/preset-antd` 是基于ant design vue的Preset实现。

`@koala-form/preset-fesd` 是基于fes design的Preset实现。

我们也非常欢迎您贡献更多的preset实现！